
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
  <head>
    <meta charset="utf-8" />
    <title>Виртуализация &#8212; документация Неофициальный FAQ по Fedora 2019.11.30</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="shortcut icon" href="_static/faq-icon.ico"/>
    <link rel="index" title="Алфавитный указатель" href="genindex.html" />
    <link rel="search" title="Поиск" href="search.html" />
    <link rel="next" title="Безопасность" href="security.html" />
    <link rel="prev" title="Сетевое администрирование" href="networking.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
    <link rel="apple-touch-icon" href="_static/faq-icon.png" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="virtualization">
<span id="id1"></span><h1>Виртуализация<a class="headerlink" href="#virtualization" title="Ссылка на этот заголовок">¶</a></h1>
<div class="section" id="virt-selection">
<span id="index-0"></span><span id="id2"></span><h2>Какую систему управления виртуальными машинами лучше установить?<a class="headerlink" href="#virt-selection" title="Ссылка на этот заголовок">¶</a></h2>
<p>Рекомендуется использовать <a class="reference internal" href="#kvm"><span class="std std-ref">KVM</span></a>, т.к. её гипервизор и необходимые модули уже находятся в ядре Linux и не вызывают проблем.</p>
</div>
<div class="section" id="cpu-virt">
<span id="index-1"></span><span id="id3"></span><h2>Как определить имеет ли процессор аппаратную поддержку виртуализации?<a class="headerlink" href="#cpu-virt" title="Ссылка на этот заголовок">¶</a></h2>
<p>Проверим наличие флагов <strong>vmx</strong> (Intel), либо <strong>svm</strong> (AMD) в выводе <code class="docutils literal notranslate"><span class="pre">/proc/cpuinfo</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>grep -Eq &#39;(vmx|svm)&#39; /proc/cpuinfo &amp;&amp; echo Yes || echo No
</pre></div>
</div>
</div>
<div class="section" id="kvm">
<span id="index-2"></span><span id="id4"></span><h2>Как правильно установить систему виртуализации KVM?<a class="headerlink" href="#kvm" title="Ссылка на этот заголовок">¶</a></h2>
<p>Установим KVM и графическую утилиту управления виртуальными машинами <strong>virt-manager</strong>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo dnf group install Virtualization
</pre></div>
</div>
<p>Перезагрузим машину для вступления изменений в силу:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo systemctl reboot
</pre></div>
</div>
</div>
<div class="section" id="kvm-users">
<span id="index-3"></span><span id="id5"></span><h2>Как отключить запрос пароля во время запуска или остановки виртуальных машин при использовании KVM?<a class="headerlink" href="#kvm-users" title="Ссылка на этот заголовок">¶</a></h2>
<p>Возможностью управления виртуальными машинами обладают члены группы <strong>libvirt</strong>, поэтому нужно добавить в неё свой аккаунт:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo usermod -a -G libvirt $(whoami)
</pre></div>
</div>
</div>
<div class="section" id="virtualbox-fedora">
<span id="virtualbox"></span><span id="index-4"></span><h2>Как правильно установить VirtualBox в Fedora?<a class="headerlink" href="#virtualbox-fedora" title="Ссылка на этот заголовок">¶</a></h2>
<p>Сначала нужно подключить репозиторий <a class="reference internal" href="generic-info.html#rpmfusion"><span class="std std-ref">RPM Fusion</span></a>, затем выполнить:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo dnf upgrade --refresh
sudo dnf install gcc kernel-devel kernel-headers akmod-VirtualBox VirtualBox
</pre></div>
</div>
<p>Для нормальной работы с USB устройствами и общими папками потребуется также добавить свой аккаунт в группу <strong>vboxusers</strong> и <strong>vboxsf</strong>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo usermod -a -G vboxusers $(whoami)
sudo usermod -a -G vboxsf $(whoami)
</pre></div>
</div>
</div>
<div class="section" id="virtualbox-kvm">
<span id="vdi-to-qcow2"></span><span id="index-5"></span><h2>Как преобразовать образ виртуальной машины VirtualBox в формат, совместимый с KVM?<a class="headerlink" href="#virtualbox-kvm" title="Ссылка на этот заголовок">¶</a></h2>
<p>Для конвертирования образов воспользуемся штатной утилитой <strong>qemu-img</strong>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>qemu-img convert -f vdi -O qcow2 /path/to/image.vdi /path/to/image.qcow2
</pre></div>
</div>
</div>
<div class="section" id="vmware-kvm">
<span id="vmdk-to-qcow2"></span><span id="index-6"></span><h2>Как преобразовать образ виртуальной машины VMWare в формат, совместимый с KVM?<a class="headerlink" href="#vmware-kvm" title="Ссылка на этот заголовок">¶</a></h2>
<p>Вариант 1. Воспользуемся утилитой <strong>virt-v2v</strong>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>virt-v2v -i vmx /path/to/image.vmx -o local -os /path/to/kvm -of qcow2
</pre></div>
</div>
<p>Вариант 2. Воспользуемся утилитой <strong>qemu-img</strong>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>qemu-img convert -f vmdk -O qcow2 /path/to/image.vmdk /path/to/image.qcow2
</pre></div>
</div>
</div>
<div class="section" id="hyper-v-kvm">
<span id="vpc-to-qcow2"></span><span id="index-7"></span><h2>Как преобразовать образ виртуальной машины Hyper-V в формат, совместимый с KVM?<a class="headerlink" href="#hyper-v-kvm" title="Ссылка на этот заголовок">¶</a></h2>
<p>Для преобразования образа воспользуемся штатной утилитой <strong>qemu-img</strong>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>qemu-img convert -f vpc -O qcow2 /path/to/image.vpc /path/to/image.qcow2
</pre></div>
</div>
</div>
<div class="section" id="cpu-windows">
<span id="windows-cpuvuln"></span><span id="index-8"></span><h2>Можно ли отключить защиту от уязвимостей CPU в гостевых Windows внутри виртуальных машин?<a class="headerlink" href="#cpu-windows" title="Ссылка на этот заголовок">¶</a></h2>
<p>Да, <a class="reference external" href="https://support.microsoft.com/en-us/help/4072698/">согласно MSDN</a>, при помощи следующего REG файла:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="na">Windows Registry Editor Version 5.00</span>

<span class="k">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management]</span>
<span class="na">&quot;FeatureSettingsOverride&quot;</span><span class="o">=</span><span class="s">dword:00000003</span>
<span class="na">&quot;FeatureSettingsOverrideMask&quot;</span><span class="o">=</span><span class="s">dword:00000003</span>
</pre></div>
</div>
</div>
<div class="section" id="image-type">
<span id="index-9"></span><span id="id6"></span><h2>Какие дисковые образы лучше: динамически расширяющиеся или фиксированного размера?<a class="headerlink" href="#image-type" title="Ссылка на этот заголовок">¶</a></h2>
<p>Фиксированного размера, т.к. они меньше фрагментируются.</p>
</div>
<div class="section" id="convert-to-fixed">
<span id="index-10"></span><span id="id7"></span><h2>Как конвертировать динамически расширяющийся образ диска VirtualBox в фиксированный?<a class="headerlink" href="#convert-to-fixed" title="Ссылка на этот заголовок">¶</a></h2>
<p>Динамическая конвертация не поддерживается, поэтому воспользуемся утилитой <strong>VBoxManage</strong>, входящей в базовую поставку VirtualBox, для создания нового дискового образа на базе старого:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>VBoxManage clonehd /path/to/System.vdi /path/to/System_fixed.vdi --variant Fixed
</pre></div>
</div>
<p>Теперь в свойствах виртуальной машины подключим новый образ фиксированного размера. Старый при этом можно удалить.</p>
</div>
<div class="section" id="kvm-cpu">
<span id="kvm-no-acceleration"></span><span id="index-11"></span><h2>Можно ли использовать KVM на CPU без поддержки аппаратной виртуализации?<a class="headerlink" href="#kvm-cpu" title="Ссылка на этот заголовок">¶</a></h2>
<p>Нет. KVM требует наличие активной <a class="reference internal" href="#cpu-virt"><span class="std std-ref">аппаратной виртуализации</span></a> и при её осутствии работать не будет.</p>
<p>В то же время, без наличия этой функции со стороны CPU, могут работать VirtualBox и VMWare, хотя и с очень низкой производительностью.</p>
</div>
<div class="section" id="kvm-move-directory">
<span id="index-12"></span><span id="id8"></span><h2>Можно ли перенести каталог с образами виртуальных машин KVM?<a class="headerlink" href="#kvm-move-directory" title="Ссылка на этот заголовок">¶</a></h2>
<p>По умолчанию образы создаваемых виртуальных машин создаются в каталоге <code class="docutils literal notranslate"><span class="pre">/var/lib/libvirt/images</span></code>, что многих не устраивает.</p>
<p>Переместим образы виртуальных машин на отдельный накопитель, смонтированный как <code class="docutils literal notranslate"><span class="pre">/media/foo-bar</span></code>. ISO будем размещать в каталоге <code class="docutils literal notranslate"><span class="pre">iso</span></code>, а дисковые образы виртуальных машин - <code class="docutils literal notranslate"><span class="pre">images</span></code>.</p>
<p>Создаём собственные политики SELinux для указанных каталогов:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo semanage fcontext -a -t virt_image_t &quot;/media/foo-bar/iso(/.*)?&quot;
sudo semanage fcontext -a -t virt_image_t &quot;/media/foo-bar/images(/.*)?&quot;
</pre></div>
</div>
<p>Сбросим контекст безопасности SELinux для них:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo restorecon -Rv /media/foo-bar/iso
sudo restorecon -Rv /media/foo-bar/images
</pre></div>
</div>
<p>В настройках Virt Manager добавим новую библиотеку <code class="docutils literal notranslate"><span class="pre">/media/foo-bar/images</span></code> и зададим её использование для всех виртуальных машин по умолчанию.</p>
</div>
<div class="section" id="kvm-transfer">
<span id="index-13"></span><span id="id9"></span><h2>Как переместить виртуальную машину KVM на другой ПК?<a class="headerlink" href="#kvm-transfer" title="Ссылка на этот заголовок">¶</a></h2>
<p>Переместим образы дисков из каталога <code class="docutils literal notranslate"><span class="pre">/var/lib/libvirt/images</span></code> старого хоста на новый <a class="reference internal" href="administration.html#copying-data"><span class="std std-ref">любым удобным способом</span></a>.</p>
<p>Экспортируем конфигурацию виртуальной машины:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>virsh dumpxml vmname &gt; vmname.xml
</pre></div>
</div>
<p>Здесь <strong>vmname</strong> - название машины KVM, а <strong>vmname.xml</strong> - имя файла, в котором будут сохранены настройки.</p>
<p>Импортируем ранее сохранённую конфигурацию:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>virsh define /path/to/vmname.xml
</pre></div>
</div>
<p>Новая виртуальная машина появится в списке и будет готова к работе немедленно.</p>
</div>
<div class="section" id="virtualbox-transfer">
<span id="index-14"></span><span id="id10"></span><h2>Как переместить виртуальную машину VirtualBox на другой ПК?<a class="headerlink" href="#virtualbox-transfer" title="Ссылка на этот заголовок">¶</a></h2>
<p>Получим список доступных виртуальных машин VirtualBox:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>vboxmanage list vms
</pre></div>
</div>
<p>Экспортируем настройки и данные в открытый формат виртуализации версии 2.0:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>vboxmanage export vmname -o vmname.ova --ovf20
</pre></div>
</div>
<p>Здесь <strong>vmname</strong> - название виртуальной машины VirtualBox, а <strong>vmname.ova</strong> - имя файла экспорта.</p>
<p>Переместим полученный файл на новый хост <a class="reference internal" href="administration.html#copying-data"><span class="std std-ref">любым удобным способом</span></a>, затем осуществим его импорт:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>vboxmanage import /path/to/vmname.ova --options importtovdi
</pre></div>
</div>
<p>Через некоторое время новая виртуальная машина появится в списке и будет готова к работе.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Быстрый поиск</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Искать" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Навигация</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="generic-info.html">Основная информация</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Установка системы</a></li>
<li class="toctree-l1"><a class="reference internal" href="package-manager.html">Пакетный менеджер и установка пакетов</a></li>
<li class="toctree-l1"><a class="reference internal" href="administration.html">Системное администрирование</a></li>
<li class="toctree-l1"><a class="reference internal" href="networking.html">Сетевое администрирование</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Виртуализация</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#virt-selection">Какую систему управления виртуальными машинами лучше установить?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cpu-virt">Как определить имеет ли процессор аппаратную поддержку виртуализации?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#kvm">Как правильно установить систему виртуализации KVM?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#kvm-users">Как отключить запрос пароля во время запуска или остановки виртуальных машин при использовании KVM?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#virtualbox-fedora">Как правильно установить VirtualBox в Fedora?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#virtualbox-kvm">Как преобразовать образ виртуальной машины VirtualBox в формат, совместимый с KVM?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vmware-kvm">Как преобразовать образ виртуальной машины VMWare в формат, совместимый с KVM?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hyper-v-kvm">Как преобразовать образ виртуальной машины Hyper-V в формат, совместимый с KVM?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cpu-windows">Можно ли отключить защиту от уязвимостей CPU в гостевых Windows внутри виртуальных машин?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#image-type">Какие дисковые образы лучше: динамически расширяющиеся или фиксированного размера?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#convert-to-fixed">Как конвертировать динамически расширяющийся образ диска VirtualBox в фиксированный?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#kvm-cpu">Можно ли использовать KVM на CPU без поддержки аппаратной виртуализации?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#kvm-move-directory">Можно ли перенести каталог с образами виртуальных машин KVM?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#kvm-transfer">Как переместить виртуальную машину KVM на другой ПК?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#virtualbox-transfer">Как переместить виртуальную машину VirtualBox на другой ПК?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Безопасность</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-system.html">Работа в системе</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-applications.html">Сторонние приложения</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware.html">Оборудование</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Разработка и сборка пакетов</a></li>
<li class="toctree-l1"><a class="reference internal" href="tips-and-tricks.html">Оптимизация и тонкая настройка</a></li>
<li class="toctree-l1"><a class="reference internal" href="legal-info.html">Правовая информация</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="networking.html" title="предыдущая глава">Сетевое администрирование</a></li>
      <li>Next: <a href="security.html" title="следующая глава">Безопасность</a></li>
  </ul></li>
</ul>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018 - 2019, EasyCoding Team and contributors.
      
    </div>

    
    <a href="https://github.com/RussianFedora/FAQ" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="_static/forkme_right_green.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>